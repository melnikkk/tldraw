"use strict";(()=>{var e={};e.id=389,e.ids=[389],e.modules={3418:e=>{e.exports=require("@octokit/plugin-retry")},1959:e=>{e.exports=require("json5")},8622:e=>{e.exports=require("lodash.throttle")},5494:e=>{e.exports=require("lodash.uniq")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4287:e=>{e.exports=require("octokit")},1122:e=>{e.exports=import("fractional-indexing-jittered")},2081:e=>{e.exports=require("child_process")},6206:e=>{e.exports=require("console")},3292:e=>{e.exports=require("fs/promises")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},9931:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var i=n(9150),o=n(1631),a=n(6835),s=n(9635),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,a.l)(s,"default"),u=(0,a.l)(s,"config"),d=new i.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/on-release",pathname:"/api/on-release",bundlePath:"",filename:""},userland:s});r()}catch(e){r(e)}})},9635:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>f});var i=n(7181),o=n(1179),a=n(7378),s=n(2842),c=n(9851),l=n(3096),u=e([i,o,s,c]);[i,o,s,c]=u.then?(await u)():u;let d=o.T.object({tagToRelease:o.T.string,apiKey:o.T.string,canary:o.T.boolean.optional()}),f=(0,l.N)("/api/on-release",async function(e,t){(0,i.hu)("POST"===e.method);let n=d.validate(e.body);if((0,i.hu)("string"==typeof process.env.DEVELOPER_ACCESS_KEY),n.apiKey!==process.env.DEVELOPER_ACCESS_KEY){t.status(401).send("Bad api key");return}let{tagToRelease:r}=n;await s.o.onCustomHook(await (0,c.h)(a.bw),{tagToRelease:r,canary:!!n.canary}),t.send("Created standalone examples branch")});r()}catch(e){r(e)}})},2842:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{o:()=>f});var i=n(7181),o=n(3292),a=n(1017),s=n(19),c=n(9398),l=e([i]);i=(l.then?(await l)():l)[0];let u=[".gitignore",".prettierrc","LICENSE.md"],d=["typescript","@types/react","@types/react-dom"],f={name:"standaloneExamplesBranch",onCustomHook:async(e,t)=>{await (0,s.Ff)("public",e.installationToken,t.tagToRelease,async({git:e,repoPath:n})=>{let r=a.join(n,".git","standalone-examples"),s=await e.trimmed("rev-parse","HEAD"),l=`standalone-examples-${s}`;for(let t of(await e("checkout","-b",l),console.log("Copying examples into new folder..."),await e.lines("ls-files","apps/examples"))){let e=a.relative("apps/examples",t);await o.mkdir(a.join(r,a.dirname(e)),{recursive:!0}),await o.copyFile(a.join(n,t),a.join(r,e))}for(let e of u)await o.copyFile(a.join(n,e),a.join(r,e));console.log("Creation tsconfig.json...");let f=await (0,c.OY)(a.join(n,"internal/config/tsconfig.base.json"));f.includes=["src"],await o.writeFile(a.join(r,"tsconfig.json"),JSON.stringify(f,null,"	")),console.log("Creation package.json...");let p=await (0,c.OY)(a.join(n,"package.json")),h=await (0,c.OY)(a.join(r,"package.json"));for(let e of d)h.dependencies[e]=p.dependencies[e];for(let e of Object.keys(h.dependencies)){if(!e.startsWith("@tldraw/"))continue;let r=await (0,c.OY)(a.join(n,"packages",e.replace("@tldraw/",""),"package.json"));if((0,i.hu)(r,`package.json for ${e} must exist`),t.canary){let t=r.version.replace(/-.*$/,""),n=`canary.${s.slice(0,12)}`;h.dependencies[e]=`${t}-${n}`}else h.dependencies[e]=r.version}for(let e of(await o.writeFile(a.join(r,"package.json"),JSON.stringify(h,null,"	")),console.log("Deleting existing repo contents..."),await o.readdir(n)))".git"!==e&&await o.rm(a.join(n,e),{recursive:!0,force:!0});for(let e of(console.log("Moving new repo contents into place..."),await o.readdir(r)))await o.rename(a.join(r,e),a.join(n,e));await o.rm(r,{recursive:!0,force:!0}),console.log("Committing & pushing changes..."),await e("add","-A"),await e("commit","-m",`[automated] Update standalone examples from ${t.tagToRelease}`),await e("push","--force","origin",`${l}:examples`)})}};r()}catch(e){r(e)}})},9851:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{h:()=>a});var i=n(5250),o=e([i]);async function a(e){let t=(0,i.xA)();for await(let{installation:n}of t.eachInstallation.iterator())if(n.account&&"login"in n.account&&n.account.login===e)return{app:t,installationId:n.id,octokit:await t.getInstallationOctokit(n.id),installationToken:await (0,i.Gc)(t,n.id)};throw Error(`No installation found for org ${e}`)}i=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},19:(e,t,n)=>{n.d(t,{Ff:()=>g});var r=n(3292),i=n(2037),o=n(1017),a=n(2081);async function s(e,t,{pwd:n=process.cwd(),processStdoutLine:r=e=>process.stdout.write(`${e}
`),processStderrLine:i=e=>process.stderr.write(`${e}
`),env:o}={}){return function(...e){console.log(...e)}(`> $ ${e} ${t.join(" ")} (in ${n}))`),new Promise((s,c)=>{let l=[],u=(0,a.execFile)(e,t.filter(e=>!!e),{cwd:n,env:{...process.env,...o}},e=>{e?c(e):s(l.join(""))}),d="";u.stdout.on("data",e=>{let t=e.toString("utf-8");l.push(t);let n=t.split("\n");for(let e of(n[0]=d+n[0],d=n.pop()??"",n))r(e)}),u.stdout.on("close",()=>{r(d)});let f="";u.stderr.on("data",e=>{let t=e.toString("utf-8");l.push(t);let n=t.split("\n");for(let e of(n[0]=f+n[0],f=n.pop()??"",n))i(e)}),u.stderr.on("close",()=>{i(f)})})}class c{enqueue(e){return new Promise((t,n)=>{this.currentTask=this.currentTask.then(async()=>{try{t(await e())}catch(e){n(e)}})})}constructor(){this.currentTask=Promise.resolve()}}var l=n(7378);let u=new c,d={public:{org:l.bw,name:l.M6,path:"tldraw-public",queue:new c}};function f(e){let t=async(t,...n)=>{var r;return s("git",[t,...n],{pwd:e,...(r=`[git ${t}] `,{processStdoutLine:e=>process.stdout.write(`${r}${e}
`),processStderrLine:e=>process.stderr.write(`${r}${e}
`)})})};return t.trimmed=async(e,...n)=>(await t(e,...n)).trim(),t.lines=async(e,...n)=>(await t(e,...n)).trim().split("\n"),t.cd=t=>f(o.join(e,t)),t}async function p(){try{return await r.writeFile("/tldraw_repo_sync_data/check","ok"),"/tldraw_repo_sync_data"}catch{let e=o.join(i.tmpdir(),"tldraw_repo_sync_data");return await r.mkdir(e,{recursive:!0}),e}}async function h(e,t){let n=d[e],i=await p(),a=o.join(i,n.path);try{await r.rm(a,{recursive:!0,force:!0})}catch{}let c=`https://x-access-token:${t}@github.com/${n.org}/${n.name}.git`;await u.enqueue(()=>s("git",["clone","--mirror",c,a]))}async function w(e,t){let n=d[e];return await n.queue.enqueue(async()=>{let i=await p(),a=o.join(i,n.path),s=f(a);try{await r.readFile(o.join(a,"HEAD"))}catch{return await h(e,t),{repo:n,path:a}}return(await s.trimmed("remote","get-url","origin")).endsWith(`@github.com/${n.org}/${n.name}.git`)?(await s("remote","set-url","origin",`https://x-access-token:${t}@github.com/${n.org}/${n.name}.git`),await s("remote","update")):await h(e,t),{repo:n,path:a}})}async function g(e,t,n,a){let{repo:c,path:l}=await w(e,t),d=o.join(i.tmpdir(),`tldraw_repo_sync_${Math.random().toString(36).slice(2)}`);await u.enqueue(()=>s("git",["clone","--no-checkout",l,d]));let p=f(d);try{return await p("remote","set-url","origin",`https://x-access-token:${t}@github.com/${c.org}/${c.name}.git`),await p("checkout",n),await y(d),await a({repoPath:d,git:p})}finally{await r.rm(d,{recursive:!0})}}async function y(e){let t=f(e);await t("config","--local","user.name",l.ZJ),await t("config","--local","user.email",l.A8)}},9038:(e,t,n)=>{n.d(t,{e:()=>a});var r=n(2037),i=n.n(r);let o=process.env.HUPPY_WEBHOOK_URL;async function a(e,t){if(void 0===o)throw Error("HUPPY_WEBHOOK_URL not set");let n=JSON.stringify({content:`[${i().hostname}] ${e}:
\`\`\`
${t.stack}
\`\`\``});console.log(e,t.stack),await fetch(o,{method:"POST",body:n,headers:{"Content-Type":"application/json"}})}},3096:(e,t,n)=>{n.d(t,{N:()=>i});var r=n(9038);function i(e,t){return async(n,i)=>{try{await t(n,i)}catch(t){(0,r.e)(`Error in ${e}`,t),i.status(500).json({error:t.message})}}}},9398:(e,t,n)=>{n.d(t,{Fs:()=>a,OY:()=>d,_J:()=>l,eV:()=>s,kC:()=>c});var r=n(3292),i=n(1959),o=n.n(i);function a(e,t){let n=e.headers[t];if(!n)throw Error(`Missing header: ${t}`);if(Array.isArray(n))throw Error(`Header ${t} has multiple values`);return n}function s(e){return e.replace(/[_-]([a-z0-9])/gi,e=>e[1].toUpperCase())}function c(e){return e[0].toUpperCase()+e.slice(1)}function l(e){return`${((Date.now()-e)/1e3).toFixed(2)}s`}async function u(e){try{return await r.readFile(e,"utf8")}catch{return null}}async function d(e){let t=await u(e);return null===t?null:o().parse(t)}},1179:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{T:()=>o});var i=n(7181),o=n(6159),a=e([i,o]);[i,o]=a.then?(await a)():a,(0,i.x2)(globalThis.TLDRAW_LIBRARY_NAME,globalThis.TLDRAW_LIBRARY_VERSION,globalThis.TLDRAW_LIBRARY_MODULES),r()}catch(e){r(e)}})},6159:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{ArrayOfValidator:()=>E,DictValidator:()=>S,ObjectValidator:()=>V,UnionValidator:()=>U,ValidationError:()=>k,Validator:()=>O,any:()=>N,array:()=>F,arrayOf:()=>u,bigint:()=>R,boolean:()=>L,dict:()=>h,httpUrl:()=>H,indexKey:()=>B,integer:()=>T,jsonDict:()=>p,jsonValue:()=>I,linkUrl:()=>D,literal:()=>l,literalEnum:()=>j,model:()=>y,nonZeroInteger:()=>C,nonZeroNumber:()=>P,nullable:()=>b,number:()=>_,numberUnion:()=>g,object:()=>d,optional:()=>v,or:()=>x,positiveInteger:()=>q,positiveNumber:()=>G,setEnum:()=>m,srcUrl:()=>Y,string:()=>K,union:()=>w,unknown:()=>A,unknownObject:()=>J});var i=n(7181),o=e([i]);i=(o.then?(await o)():o)[0];class k extends Error{constructor(e,t=[]){let n=function(e){if(!e.length)return null;let t="";for(let n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return(t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,"")).startsWith(".")?t.slice(1):t}(t),r=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${n}: ${r}`:r),this.rawMessage=e,this.path=t,this.name="ValidationError"}}function a(e,t){try{return t()}catch(t){if(t instanceof k)throw new k(t.rawMessage,[e,...t.path]);throw new k(t.toString(),[e])}}function s(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:(0,i.iP)(t)}}class O{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return b(this)}optional(){return v(this)}refine(e){return new O(t=>e(this.validate(t)),(t,n)=>{let r=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,r)?t:e(r)})}check(e,t){return"string"==typeof e?this.refine(n=>(a(`(check ${e})`,()=>t(n)),n)):this.refine(t=>(e(t),t))}}class E extends O{constructor(e){super(t=>{let n=F.validate(t);for(let t=0;t<n.length;t++)a(t,()=>e.validate(n[t]));return n},(t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);let r=F.validate(n),i=t.length!==r.length;for(let n=0;n<r.length;n++){let o=r[n];if(n>=t.length){i=!0,a(n,()=>e.validate(o));continue}if(Object.is(t[n],o))continue;let s=a(n,()=>e.validateUsingKnownGoodVersion(t[n],o));Object.is(s,t[n])||(i=!0)}return i?n:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new k("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new k("Expected an array with length greater than 1")})}}class V extends O{constructor(e,t=!1){super(n=>{if("object"!=typeof n||null===n)throw new k(`Expected object, got ${s(n)}`);for(let[t,r]of Object.entries(e))a(t,()=>{r.validate((0,i.eg)(n,t))});if(!t){for(let t of Object.keys(n))if(!(0,i.nr)(e,t))throw new k("Unexpected property",[t])}return n},(n,r)=>{if("object"!=typeof r||null===r)throw new k(`Expected object, got ${s(r)}`);let o=!1;for(let[t,s]of Object.entries(e)){let e=(0,i.eg)(n,t),c=(0,i.eg)(r,t);if(Object.is(e,c))continue;let l=a(t,()=>s.validateUsingKnownGoodVersion?s.validateUsingKnownGoodVersion(e,c):s.validate(c));Object.is(l,e)||(o=!0)}if(!t){for(let t of Object.keys(r))if(!(0,i.nr)(e,t))throw new k("Unexpected property",[t])}for(let e of Object.keys(n))if(!(0,i.nr)(r,e)){o=!0;break}return o?r:n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new V(this.config,!0)}extend(e){return new V({...this.config,...e})}}class U extends O{constructor(e,t,n,r){super(t=>{this.expectObject(t);let{matchingSchema:n,variant:r}=this.getMatchingSchemaAndVariant(t);return void 0===n?this.unknownValueValidation(t,r):a(`(${e} = ${r})`,()=>n.validate(t))},(t,n)=>{this.expectObject(n),this.expectObject(t);let{matchingSchema:r,variant:o}=this.getMatchingSchemaAndVariant(n);return void 0===r?this.unknownValueValidation(n,o):(0,i.eg)(t,e)!==(0,i.eg)(n,e)?a(`(${e} = ${o})`,()=>r.validate(n)):a(`(${e} = ${o})`,()=>r.validateUsingKnownGoodVersion?r.validateUsingKnownGoodVersion(t,n):r.validate(n))}),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=r}expectObject(e){if("object"!=typeof e||null===e)throw new k(`Expected an object, got ${s(e)}`,[])}getMatchingSchemaAndVariant(e){let t=(0,i.eg)(e,this.key);if(this.useNumberKeys||"string"==typeof t){if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new k(`Expected a number for key "${this.key}", got "${t}"`)}else throw new k(`Expected a string for key "${this.key}", got ${s(t)}`);return{matchingSchema:(0,i.nr)(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new U(this.key,this.config,e,this.useNumberKeys)}}class S extends O{constructor(e,t){super(n=>{if("object"!=typeof n||null===n)throw new k(`Expected object, got ${s(n)}`);for(let[r,i]of Object.entries(n))a(r,()=>{e.validate(r),t.validate(i)});return n},(n,r)=>{if("object"!=typeof r||null===r)throw new k(`Expected object, got ${s(r)}`);let o=!1;for(let[s,c]of Object.entries(r)){if(!(0,i.nr)(n,s)){o=!0,a(s,()=>{e.validate(s),t.validate(c)});continue}let r=(0,i.eg)(n,s),l=c;if(Object.is(r,l))continue;let u=a(s,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(r,l):t.validate(l));Object.is(u,r)||(o=!0)}for(let e of Object.keys(n))if(!(0,i.nr)(r,e)){o=!0;break}return o?r:n}),this.keyValidator=e,this.valueValidator=t}}function c(e){return new O(t=>{if(typeof t!==e)throw new k(`Expected ${e}, got ${s(t)}`);return t})}let A=new O(e=>e),N=new O(e=>e),K=c("string"),_=c("number").check(e=>{if(Number.isNaN(e))throw new k("Expected a number, got NaN");if(!Number.isFinite(e))throw new k(`Expected a finite number, got ${e}`)}),G=_.check(e=>{if(e<0)throw new k(`Expected a positive number, got ${e}`)}),P=_.check(e=>{if(e<=0)throw new k(`Expected a non-zero positive number, got ${e}`)}),T=_.check(e=>{if(!Number.isInteger(e))throw new k(`Expected an integer, got ${e}`)}),q=T.check(e=>{if(e<0)throw new k(`Expected a positive integer, got ${e}`)}),C=T.check(e=>{if(e<=0)throw new k(`Expected a non-zero positive integer, got ${e}`)}),L=c("boolean"),R=c("bigint");function l(e){return new O(t=>{if(t!==e)throw new k(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}let F=new O(e=>{if(!Array.isArray(e))throw new k(`Expected an array, got ${s(e)}`);return e});function u(e){return new E(e)}let J=new O(e=>{if("object"!=typeof e||null===e)throw new k(`Expected object, got ${s(e)}`);return e});function d(e){return new V(e)}function f(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===i.qB)}let I=new O(e=>{if(function e(t){return null===t||"number"==typeof t||"string"==typeof t||"boolean"==typeof t||(Array.isArray(t)?t.every(e):!!f(t)&&Object.values(t).every(e))}(e))return e;throw new k(`Expected json serializable value, got ${typeof e}`)},(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=e.length!==t.length;for(let r=0;r<t.length;r++){if(r>=e.length){n=!0,I.validate(t[r]);continue}let i=e[r],o=t[r];if(Object.is(i,o))continue;let a=I.validateUsingKnownGoodVersion(i,o);Object.is(a,i)||(n=!0)}return n?t:e}if(!(f(e)&&f(t)))return I.validate(t);{let n=!1;for(let r of Object.keys(t)){if(!(0,i.nr)(e,r)){n=!0,I.validate(t[r]);continue}let o=e[r],a=t[r];if(Object.is(o,a))continue;let s=I.validateUsingKnownGoodVersion(o,a);Object.is(s,o)||(n=!0)}for(let r of Object.keys(e))if(!(0,i.nr)(t,r)){n=!0;break}return n?t:e}});function p(){return h(K,I)}function h(e,t){return new S(e,t)}function w(e,t){return new U(e,t,(n,r)=>{throw new k(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])},!1)}function g(e,t){return new U(e,t,(n,r)=>{throw new k(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])},!0)}function y(e,t){return new O(n=>a(e,()=>t.validate(n)),(n,r)=>a(e,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(n,r):t.validate(r)))}function m(e){return new O(t=>{if(!e.has(t)){let n=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new k(`Expected ${n}, got ${t}`)}return t})}function v(e){return new O(t=>{if(void 0!==t)return e.validate(t)},(t,n)=>{if((void 0!==t||void 0!==n)&&void 0!==n)return e.validateUsingKnownGoodVersion&&void 0!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)})}function b(e){return new O(t=>null===t?null:e.validate(t),(t,n)=>null===n?null:e.validateUsingKnownGoodVersion&&null!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n))}function j(...e){return m(new Set(e))}function $(e){try{return new URL(e)}catch{if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch{}throw new k(`Expected a valid url, got ${JSON.stringify(e)}`)}}let M=new Set(["http:","https:","mailto:"]),D=K.check(e=>{if(""===e)return;let t=$(e);if(!M.has(t.protocol.toLowerCase()))throw new k(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),W=new Set(["http:","https:","data:","asset:"]),Y=K.check(e=>{if(""===e)return;let t=$(e);if(!W.has(t.protocol.toLowerCase()))throw new k(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),H=K.check(e=>{if(""!==e&&!$(e).protocol.toLowerCase().match(/^https?:$/))throw new k(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),B=K.refine(e=>{try{return(0,i.LP)(e),e}catch{throw new k(`Expected an index key, got ${JSON.stringify(e)}`)}});function x(e,t){return new O(n=>{try{return e.validate(n)}catch{return t.validate(n)}})}r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[516],()=>n(9931));module.exports=r})();